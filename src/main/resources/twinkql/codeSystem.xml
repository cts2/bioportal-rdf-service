<?xml version="1.0" encoding="UTF-8"?>
<sparqlMap namespace="codeSystem"
	xmlns="http://mayo.edu/twinkql" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	
	<perRowResultMap id="codeSystemCatalogEntrySummaryResult" 
		resultClass="edu.mayo.cts2.framework.model.codesystem.CodeSystemCatalogEntrySummary"
		afterMap="spring:codeSystemSummaryHrefCallback">
		<rowMap var="abr" varType="literalValue" beanProperty="resourceName"/>
		<rowMap var="abr" varType="literalValue" beanProperty="codeSystemName"/>
		<rowMap var="description" varType="literalValue" beanProperty="resourceSynopsis.value.content"/>
		<rowMap var="s" varType="uri" beanProperty="about"/>
	</perRowResultMap>
	
	<compositeResultMap id="codeSystemCatalogEntryResult"
	 	extends="common:abstractResourceDescriptionResultMap" 
		resultClass="edu.mayo.cts2.framework.model.codesystem.CodeSystemCatalogEntry"
		afterMap="spring:codeSystemHrefCallback">
		<tripleMap var="o" varType="literalValue" predicateUri="http://purl.bioontology.org/ontology/bioportal/abbreviation" beanProperty="codeSystemName"/>
	</compositeResultMap>
	
	<select id="getCodeSystemCatalogSummaries" resultMap="codeSystemCatalogEntrySummaryResult">
	<![CDATA[

		SELECT ?s ?abr ?description
		WHERE { 
		  GRAPH ?graphURI { 
		    ?s a <http://www.w3.org/2002/07/owl#Ontology> . 
		    ?s <http://purl.bioontology.org/ontology/bioportal/abbreviation> ?abr . 
		    OPTIONAL { ?s <http://purl.bioontology.org/ontology/bioportal/description> ?description . } 
		    OPTIONAL { ?s <http://purl.bioontology.org/ontology/bioportal/format> ?format . } 
		    OPTIONAL { ?s <http://purl.bioontology.org/ontology/bioportal/displayLabel> ?label . } 
		    OPTIONAL { ?s <http://purl.bioontology.org/ontology/bioportal/uri> ?uri . } 
		    OPTIONAL { ?s <http://purl.org/dc/elements/1.1/creator> ?creator . } 
		    OPTIONAL { ?s <http://purl.org/dc/elements/1.1/contributor> ?contributor . } 
		    OPTIONAL { ?s <http://www.w3.org/2002/07/owl#imports> ?imports . } 
		    OPTIONAL { ?s <http://purl.org/dc/elements/1.1/title> ?title } 
		  } 
	    }
	    LIMIT  #{limit}
	    OFFSET #{offset}
	 
	 ]]>
	</select>
	
	<select id="getCodeSystemByName" resultMap="codeSystemCatalogEntryResult">
	<![CDATA[

		SELECT ?s ?p ?o
		WHERE {
 			GRAPH ?graph {
   				?s a <http://www.w3.org/2002/07/owl#Ontology>;
   				<http://purl.bioontology.org/ontology/bioportal/abbreviation> "#{name}";
   				?p ?o
   			}
		}
	 
	 ]]>
	</select>
	
	<select id="getCodeSystemByUri" resultMap="codeSystemCatalogEntryResult">
	<![CDATA[

		SELECT ?s ?p ?o
		WHERE {
 			GRAPH ?graph {
   				<#{uri}> ?p ?o .
   				?s ?p ?o
   			}
		}
	 
	 ]]>
	</select>
</sparqlMap>
