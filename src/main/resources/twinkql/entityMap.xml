<?xml version="1.0" encoding="UTF-8"?>
<sparqlMap namespace="entity"
	xmlns="http://mayo.edu/twinkql" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://mayo.edu/twinkql https://raw.github.com/cts2/twinkql/master/src/main/castor/twinkql.xsd">
	
	<compositeResultMap id="entityDescriptionResultMap" 
		resultClass="edu.mayo.cts2.framework.model.entity.EntityDescription"
		afterMap="spring:entityDescriptionCallback">
		<nestedResultMap resultMap="entity:designationResultMap1" beanProperty="namedEntity.designationAsReference[]"/>
		<nestedResultMap resultMap="entity:designationResultMap2" beanProperty="namedEntity.designationAsReference[]"/>
		<if function="spring:isLiteral" param="o">
			<nestedResultMap resultMap="common:propertyResultMap" beanProperty="namedEntity.propertyAsReference[]" />	
		</if>
		<tripleMap var="o" varType="localName" predicateUri="rdfs:type" beanProperty="namedEntity.entityID.name"/>
		<tripleMap var="s" varType="namespace" predicateUri="rdfs:type" beanProperty="namedEntity.entityID.namespace" modifier="spring:namespaceModifier" />
		<tripleMap var="s" varType="uri" predicateUri="rdfs:type" beanProperty="namedEntity.about"/>
		<tripleMap var="graph" varType="localName" predicateUri="rdfs:type" callbackId="graph"/>	
		<tripleMap var="o" varType="localName" predicateUri="rdfs:type" beanProperty="namedEntity.entityTypeAsReference[0].name"/>
		<tripleMap var="o" varType="uri" predicateUri="rdfs:type" beanProperty="namedEntity.entityTypeAsReference[0].uri"/>
		<tripleMap var="o" varType="namespace" predicateUri="rdfs:type" beanProperty="namedEntity.entityTypeAsReference[0].namespace" modifier="spring:namespaceModifier" />
	</compositeResultMap>
	
	<compositeResultMap id="designationResultMap1" 
		resultClass="edu.mayo.cts2.framework.model.entity.Designation"
		afterMap="spring:preferredDesignationCallback">
		<tripleMap var="o" varType="literalValue" predicateUri="rdfs:label" beanProperty="value.content"/>
		<tripleMap var="o" varType="literalValue" predicateUri="skos:prefLabel" beanProperty="value.content" />
	</compositeResultMap>
	
	<compositeResultMap id="designationResultMap2" 
		resultClass="edu.mayo.cts2.framework.model.entity.Designation"
		afterMap="spring:alternateDesignationCallback">
		<tripleMap var="o" varType="literalValue" predicateUri="skos:altLabel" beanProperty="value.content"/>
	</compositeResultMap>
	
	<select id="getEntityDescriptionByUri" resultMap="entityDescriptionResultMap">
		<![CDATA[
		SELECT (<#{uri}> as ?s) ?p ?o ?graph
		WHERE {		
			<isNotNull property="ontologyId">
      		GRAPH ?graph {
      		</isNotNull>
      			<#{uri}> ?p ?o .
      		<isNotNull property="ontologyId">
      		}
      		</isNotNull>
		} 
		]]>
	</select>

</sparqlMap>
